services:
  trad-bot:
    # Build local uniquement
    build: .
    container_name: trad-bot-opencode
    volumes:
      # Donnees utilisateur (synchronises avec le repo Git dans le container)
      - ${USERPROFILE}/AuxPetitsOignons/clients:/app/src/clients
      - ${USERPROFILE}/AuxPetitsOignons/Solution:/app/src/Solution
      # Configuration OpenCode
      - ./conf_opencode:/app/conf_opencode_mount
      # Partage les credentials Azure de Windows -> pas de device login !
      - ${USERPROFILE}/.azure:/root/.azure
    ports:
      - "5545:8080"
    stdin_open: true
    tty: true
    working_dir: /app/src
    entrypoint: /usr/local/bin/entrypoint.sh
    command: bash -c "python /app/doc_server.py & exec bash"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
