[pytest]
# Configuration pytest pour le projet Aux Petits Oignons

# Chemins de découverte des tests
testpaths = tests azure_wrappers/tests

# Patterns de fichiers de test
python_files = test_*.py *_test.py

# Patterns de classes de test
python_classes = Test*

# Patterns de fonctions de test
python_functions = test_*

# Marqueurs personnalisés
markers =
    e2e: Tests End-to-End (déploiement réel sur Azure)
    slow: Tests lents (> 30 secondes)
    unit: Tests unitaires (rapides, avec mocks)
    integration: Tests d'intégration (mocks partiels)
    critical: Tests critiques (doivent passer avant commit)
    sku_f0: Tests vérifiant le SKU F0 Translator

# Options par défaut
addopts =
    # Verbosité
    -v
    # Afficher print() dans les tests
    -s
    # Afficher résumé des tests skipped/xfailed
    -ra
    # Afficher pourcentage de progression
    --tb=short
    # Désactiver warnings
    -p no:warnings

# Timeout par défaut pour les tests (en secondes)
# Peut être overridé avec @pytest.mark.timeout(seconds)
timeout = 600

# Ordre d'exécution des tests
# Les tests E2E doivent être exécutés dans l'ordre
# (test_01 avant test_02, etc.)

# Parallélisation (décommentez si pytest-xdist installé)
# addopts = -n auto

# Coverage (décommentez si pytest-cov installé)
# addopts = --cov=azure_wrappers --cov-report=html --cov-report=term

# Logging
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Fichier de log
log_file = tests/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)s] %(name)s: %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# Répertoire pour les fichiers temporaires de test
tmp_path_retention_count = 3
tmp_path_retention_policy = failed

# Ignorer certains chemins
norecursedirs = .git .tox dist build *.egg __pycache__ .cache

# Configuration xfail
xfail_strict = false

# Minimum version de Python requise
minversion = 3.8
